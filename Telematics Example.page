Telematics Product Line
-----------------------

Vehicle telematics systems integrate multiple telecommunication and information processing functions in an automobile, 
such as navigation, driving assistance, emergency and warning systems, hands-free phone, and entertainment functions,
and present them to the driver and passengers via multimedia displays. 

Summary of concepts
===================

<figure>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.28.0 (20110507.0327)
 -->
<!-- Title: telematics_simplified Pages: 1 -->
<svg width="558pt" height="266pt"
 viewBox="0.00 0.00 558.00 266.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph1" class="graph" transform="scale(1 1) rotate(0) translate(4 262)">
<title>telematics_simplified</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-262 555,-262 555,5 -4,5"/>
<!-- c1_options -->
<g id="node1" class="node"><title>c1_options</title>
<a xlink:href="#c1_options" xlink:title="abstract options&#10; &#160;xor size&#10; &#160;&#160;&#160;small&#10; &#160;&#160;&#160;large&#10; &#160;cache ?&#10; &#160;&#160;&#160;size : integer&#10; &#160;&#160;&#160;&#160;&#160;fixed ?&#10; &#160;[small &amp;&amp; cache =&gt; fixed]">
<polygon fill="none" stroke="black" points="106.5,-36 -0.5,-36 -0.5,-0 106.5,-0 106.5,-36"/>
<text text-anchor="middle" x="53" y="-14.3" font-family="Times New Roman,serif" font-size="14.00">abstract options</text>
</a>
</g>
<!-- c16_comp -->
<g id="node2" class="node"><title>c16_comp</title>
<a xlink:href="#c16_comp" xlink:title="abstract comp&#10; &#160;version : integer = 1 + 2">
<polygon fill="none" stroke="black" points="246.5,-258 149.5,-258 149.5,-222 246.5,-222 246.5,-258"/>
<text text-anchor="middle" x="198" y="-236.3" font-family="Times New Roman,serif" font-size="14.00">abstract comp</text>
</a>
</g>
<!-- c23_ECU -->
<g id="node3" class="node"><title>c23_ECU</title>
<a xlink:href="#c23_ECU" xlink:title="abstract ECU : comp">
<polygon fill="none" stroke="black" points="341.5,-184 206.5,-184 206.5,-148 341.5,-148 341.5,-184"/>
<text text-anchor="middle" x="274" y="-162.3" font-family="Times New Roman,serif" font-size="14.00">abstract ECU : comp</text>
</a>
</g>
<!-- c23_ECU&#45;&gt;c16_comp -->
<g id="edge2" class="edge"><title>c23_ECU&#45;&gt;c16_comp</title>
<path fill="none" stroke="black" d="M255.989,-184.063C246.311,-193.232 234.214,-204.692 223.577,-214.769"/>
<polygon fill="none" stroke="black" points="220.997,-212.392 216.145,-221.81 225.812,-217.473 220.997,-212.392"/>
</g>
<!-- c24_display -->
<g id="node5" class="node"><title>c24_display</title>
<a xlink:href="#c24_display" xlink:title="abstract display : comp&#10; &#160;server &#45;&gt; ECU&#10; &#160;`options&#10; &#160;[this.version &gt;= server.version]">
<polygon fill="none" stroke="black" points="154.5,-184 7.5,-184 7.5,-148 154.5,-148 154.5,-184"/>
<text text-anchor="middle" x="81" y="-162.3" font-family="Times New Roman,serif" font-size="14.00">abstract display : comp</text>
</a>
</g>
<!-- c24_display&#45;&gt;c1_options -->
<g id="edge6" class="edge"><title>c24_display&#45;&gt;c1_options</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M77.6673,-147.622C72.8497,-122.502 63.895,-75.8096 58.2026,-46.128"/>
<polygon fill="none" stroke="black" points="61.5877,-45.1956 56.2668,-36.0338 54.713,-46.5141 61.5877,-45.1956"/>
</g>
<!-- c24_display&#45;&gt;c16_comp -->
<g id="edge4" class="edge"><title>c24_display&#45;&gt;c16_comp</title>
<path fill="none" stroke="black" d="M108.727,-184.063C124.495,-193.766 144.431,-206.034 161.462,-216.515"/>
<polygon fill="none" stroke="black" points="159.715,-219.55 170.066,-221.81 163.384,-213.588 159.715,-219.55"/>
</g>
<!-- c24_display&#45;&gt;c23_ECU -->
<g id="edge8" class="edge"><title>c24_display&#45;&gt;c23_ECU</title>
<path fill="none" stroke="black" d="M154.516,-166C168.317,-166 182.784,-166 196.696,-166"/>
<polygon fill="black" stroke="black" points="206.711,-166 196.711,-170.5 201.711,-166 196.711,-166 196.711,-166 196.711,-166 201.711,-166 196.711,-161.5 206.711,-166 206.711,-166"/>
<text text-anchor="middle" x="180.25" y="-151.8" font-family="Times New Roman,serif" font-size="14.00">server</text>
</g>
<!-- c43_plaECU -->
<g id="node9" class="node"><title>c43_plaECU</title>
<a xlink:href="#c43_plaECU" xlink:title="abstract plaECU : ECU&#10; &#160;`display 1..2&#10; &#160;&#160;&#160;[server = parent&#10; &#160;&#160;&#160;&#160;!options.cache]">
<polygon fill="none" stroke="black" points="347.5,-110 200.5,-110 200.5,-74 347.5,-74 347.5,-110"/>
<text text-anchor="middle" x="274" y="-88.3" font-family="Times New Roman,serif" font-size="14.00">abstract plaECU : ECU</text>
</a>
</g>
<!-- c43_plaECU&#45;&gt;c23_ECU -->
<g id="edge10" class="edge"><title>c43_plaECU&#45;&gt;c23_ECU</title>
<path fill="none" stroke="black" d="M274,-110.063C274,-118.193 274,-128.124 274,-137.295"/>
<polygon fill="none" stroke="black" points="270.5,-137.559 274,-147.559 277.5,-137.559 270.5,-137.559"/>
</g>
<!-- c43_plaECU&#45;&gt;c24_display -->
<g id="edge12" class="edge"><title>c43_plaECU&#45;&gt;c24_display</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M228.262,-110.063C200.721,-120.337 165.468,-133.489 136.36,-144.348"/>
<polygon fill="none" stroke="black" points="134.89,-141.16 126.744,-147.935 137.337,-147.719 134.89,-141.16"/>
</g>
<!-- c53_ECU1 -->
<g id="node12" class="node"><title>c53_ECU1</title>
<a xlink:href="#c53_ECU1" xlink:title="ECU1 : plaECU">
<polygon fill="none" stroke="black" points="248,-36 142,-36 142,-0 248,-0 248,-36"/>
<text text-anchor="middle" x="195" y="-14.3" font-family="Times New Roman,serif" font-size="14.00">ECU1 : plaECU</text>
</a>
</g>
<!-- c53_ECU1&#45;&gt;c43_plaECU -->
<g id="edge14" class="edge"><title>c53_ECU1&#45;&gt;c43_plaECU</title>
<path fill="none" stroke="black" d="M213.722,-36.063C223.88,-45.3208 236.6,-56.9143 247.735,-67.0621"/>
<polygon fill="none" stroke="black" points="245.39,-69.6607 255.139,-73.81 250.105,-64.4871 245.39,-69.6607"/>
</g>
<!-- c54_ECU2 -->
<g id="node14" class="node"><title>c54_ECU2</title>
<a xlink:href="#c54_ECU2" xlink:title="ECU2 : plaECU ?&#10; &#160;master &#45;&gt; ECU1">
<polygon fill="none" stroke="black" points="419,-36 303,-36 303,-0 419,-0 419,-36"/>
<text text-anchor="middle" x="361" y="-14.3" font-family="Times New Roman,serif" font-size="14.00">ECU2 : plaECU ?</text>
</a>
</g>
<!-- c54_ECU2&#45;&gt;c43_plaECU -->
<g id="edge16" class="edge"><title>c54_ECU2&#45;&gt;c43_plaECU</title>
<path fill="none" stroke="black" d="M340.382,-36.063C329.088,-45.4098 314.917,-57.1375 302.572,-67.3544"/>
<polygon fill="none" stroke="black" points="300.244,-64.7379 294.771,-73.81 304.707,-70.1306 300.244,-64.7379"/>
</g>
<!-- c54_ECU2&#45;&gt;c53_ECU1 -->
<g id="edge18" class="edge"><title>c54_ECU2&#45;&gt;c53_ECU1</title>
<path fill="none" stroke="black" d="M302.783,-18C288.56,-18 273.268,-18 258.8,-18"/>
<polygon fill="black" stroke="black" points="248.437,-18 258.437,-13.5001 253.437,-18 258.437,-18.0001 258.437,-18.0001 258.437,-18.0001 253.437,-18 258.437,-22.5001 248.437,-18 248.437,-18"/>
<text text-anchor="middle" x="275.5" y="-3.8" font-family="Times New Roman,serif" font-size="14.00">master</text>
</g>
<!-- c65_telematicsSystem -->
<g id="node17" class="node"><title>c65_telematicsSystem</title>
<a xlink:href="#c65_telematicsSystem" xlink:title="telematicsSystem&#10; &#160;xor channel&#10; &#160;&#160;&#160;single&#10; &#160;&#160;&#160;dual&#10; &#160;extraDisplay ?&#10; &#160;xor size&#10; &#160;&#160;&#160;small&#10; &#160;&#160;&#160;large&#10; &#160;[dual &lt;=&gt; ECU2&#10; &#160;&#160;extraDisplay &lt;=&gt; #ECU1.display = 2&#10; &#160;&#160;extraDisplay &lt;=&gt; (ECU2 =&gt; #ECU2.display = 2)&#10; &#160;&#160;large &lt;=&gt; !plaECU.display.options.size.small&#10; &#160;&#160;small &lt;=&gt; !plaECU.display.options.size.large]">
<polygon fill="none" stroke="black" points="550.5,-36 437.5,-36 437.5,-0 550.5,-0 550.5,-36"/>
<text text-anchor="middle" x="494" y="-14.3" font-family="Times New Roman,serif" font-size="14.00">telematicsSystem</text>
</a>
</g>
</g>
</svg>
<figcaption>Fig. 1: An overview of the module in the simplified notation</figcaption>
</figure>

### Module Statistics

All clafers: 26 | Abstract: 5 | Concrete: 19 | References: 2<br>
Constraints: 8<br>
Goals: 0<br>
Global scope: 1..*<br>
All names unique: False<br>


Detailed model
==============

A concrete telematics system can support either
a single or two channels; two channels afford independent programming for the
driver and the passengers. The choice is represented as the xor-group
channel. By default, each channel has one associated
display; however, we can add one extra display per channel, as indicated by
the optional feature <a href="#c69_extraDisplay">extraDisplay</a>. 
Finally, we can choose <a href="#c72_large">large</a> or <a href="#c71_small">small</a> displays (displaySize).

<div class="code" id="c65_telematicsSystem">
telematicsSystem<br>
  <span id="c66_channel" class="l1"><span class="keyword">xor</span> channel</span><br>
    <span id="c67_single" class="l2">single</span><br>
    <span id="c68_dual" class="l2">dual</span><br>
  <span id="c69_extraDisplay" class="l1">extraDisplay <span class="keyword">?</span></span><br>
  <span id="c70_size" class="l1"><span class="keyword">xor</span> size</span></a></span><br>
    <span id="c71_small" class="l2">small</span><br>
    <span id="c72_large" class="l2">large</span><br>
</div>

There are two types of components: <a href="#c23_ECU">ECU</a>s (electronic control units) and <a href="#c24_display">display</a>s.
Each display has exactly one <a href="#c23_ECU">ECU</a> as its server. All components have a version.
Components themselves may have <a href="#c1_options">options</a>, like the display size or <a href="#c5_cache">cache</a>. 
We can also specify the cache size and decide whether it is <a href="#c7_fixed">fixed</a> or
can be updated dynamically. Thus, the solution space model consists of a class
model of component types and a feature model of component options.

<figure>
  <img src="./telematics-elements.jpg" width="600px">
  <figcaption>Fig. 2: Components of a telematics system</figcaption>
</figure>


<div class="code" id="c16_comp">
<span class="keyword">abstract</span> comp<br>
  <span id="c17_version" class="l1">version <span class="keyword">:</span> integer = 1 + 2</span><br>
</div>

<div class="code" id="c23_ECU">
<span class="keyword">abstract</span> ECU <span class="keyword">:</span> <a href="#c16_comp"><span class="reference">comp</span></a><br>
</div>

<div class="code" id="c24_display">
<span class="keyword">abstract</span> display <span class="keyword">:</span> <a href="#c16_comp"><span class="reference">comp</span></a><br>
  <span id="c25_server" class="l1">server <span class="keyword">-></span> <a href="#c23_ECU"><span class="reference">ECU</span></a></span><br>
<span class="l1">`<a href="#c1_options"><span class="reference">options</span></a><br>
  <span class="l1"><span class="keyword">[</span> <a href="#this"><span class="reference">this</span></a> .<a href="#c17_version"><span class="reference">version</span></a> >= <a href="#c25_server"><span class="reference">server</span></a>.<a href="#c17_version"><span class="reference">version</span></a> <span class="keyword">]</span></span><br>
</div>

<div class="code" id="c1_options">
<span class="keyword">abstract</span> options<br>
  <span id="c2_size" class="l1"><span class="keyword">xor</span> size</span><br>
    <span id="c3_small" class="l2">small</span><br>
    <span id="c4_large" class="l2">large</span><br>   
  <span id="c5_cache" class="l1">cache <span class="keyword">?</span></span><br>
    <span id="c6_size" class="l2">size <span class="keyword">:</span> integer</span><br>
      <span id="c7_fixed" class="l3">fixed <span class="keyword">?</span></span><br>
  <span class="l1"><span class="keyword">[</span> <a href="#c3_small"><span class="reference">small</span></a> && <a href="#c5_cache"><span class="reference">cache</span></a> => <a href="#c7_fixed"><span class="reference">fixed</span></a> <span class="keyword">]</span></span><br>
</div>

The architectural meta-model is very generic: the meta-model describes infinitely
many different products, each corresponding to its particular instance. We would
like to specialize and extend the meta-model to create a particular template.
A template makes most of the architectural structure fixed, but leaves some
points of variability. 

a concrete product must have at least one ECU and thus we create
ECU1 to represent the mandatory instance. 
Then, optional instances are represented using classes with cardinality
0..1. Our product line can optionally have another ECU, represented by
ECU2.
Similarly, each ECU has either one display or two displays, but none of the
displays has cache. Besides, we need to constrain the server reference in each
display in plaECU, so that it points to its associated ECU - this constraint is nested under
display. The reference parent points to the current instance of
plaECU, which is either ECU1 or ECU2.Also, ECU2 extends the base
type with master,pointing to ECU1 as the main control unit.

<div class="code" id="c43_plaECU">
<span class="keyword">abstract</span> plaECU <span class="keyword">:</span> <a href="#c23_ECU"><span class="reference">ECU</span></a><br>
  <span id="c44_display" class="l1">`<a href="#c24_display"><span class="reference">display</span></a> 1..2</span><br>
    <span class="l2"><span class="keyword">[</span> <a href="#c25_server"><span class="reference">server</span></a> = <a href="#parent"><span class="reference">parent</span></a> <span class="keyword">]</span></span><br>
    <span class="l2"><span class="keyword">[</span> <span class="keyword">!</span><a href="#c35_options"><span class="reference">options</span></a>.<a href="#c5_cache"><span class="reference">cache</span></a> <span class="keyword">]</span></span><br>
</div>

<div class="code" id="c53_ECU1">
ECU1 <span class="keyword">:</span> <a href="#c43_plaECU"><span class="reference">plaECU</span></a><br>
</div>

<div class="code" id="c54_ECU2">
ECU2 <span class="keyword">:</span> <a href="#c43_plaECU"><span class="reference">plaECU</span></a><br>
  <span id="c55_master" class="l1">master <span class="keyword">-></span> <a href="#c53_ECU1"><span class="reference">ECU1</span></a></span><br>
</div>

<figure>
  <img src="Telematics Architecture.jpg" >
  <figcaption>Fig. 3: A possible domain-specific rendering of the product-line architecture</figcaption>
</figure>

Having defined the architectural template, we are ready to expose the remaining
variability points as a product-line feature model. 
A set of constraints coupling its features to the variability
points of the template. Note that the template allowed the number of displays
(ECU1.display and ECU2.display) and the size of every display to vary independently;
however, we further restrict the variability in the feature model, requiring
either all present ECUs to have two displays or all to have no extra display and
either all present displays to be small or all to be large. Also note that we opted
to explain the meaning of each feature in terms of the model elements to be
selected rather than defining the presence condition of each element in terms of
the features. Both approaches are available in Clafer, however.
Constraints allow us restricting a model to a single instance. The following code block shows
a top-level constraint specifying a single product, with two ECUs, two large
displays per ECU, and all components in version 1. 

<div class="code">
<span class="keyword">[</span> <a href="#c68_dual"><span class="reference">dual</span></a> <=> <a href="#c54_ECU2"><span class="reference">ECU2</span></a> <span class="keyword">]</span><br>
<span class="keyword">[</span> <a href="#c69_extraDisplay"><span class="reference">extraDisplay</span></a> <=> #<a href="#c53_ECU1"><span class="reference">ECU1</span></a>.<a href="#c44_display"><span class="reference">display</span></a> = 2 <span class="keyword">]</span><br>
<span class="keyword">[</span> <a href="#c69_extraDisplay"><span class="reference">extraDisplay</span></a> <=> <a href="#c54_ECU2"><span class="reference">ECU2</span></a> => #<a href="#c54_ECU2"><span class="reference">ECU2</span></a> .<a href="#c44_display"><span class="reference">display</span></a> = 2 <span class="keyword">]</span><br>
<span class="keyword">[</span> <a href="#c72_large"><span class="reference">large</span></a> <=> <span class="keyword">!</span><a href="#c43_plaECU"><span class="reference">plaECU</span></a>.<a href="#c44_display"><span class="reference">display</span></a>.<a href="#c35_options"><span class="reference">options</span></a>.<a href="#c2_size"><span class="reference">size</span></a>.<a href="#c3_small"><span class="reference">small</span></a> <span class="keyword">]</span><br>
<span class="keyword">[</span> <a href="#c71_small"><span class="reference">small</span></a> <=> <span class="keyword">!</span><a href="#c43_plaECU"><span class="reference">plaECU</span></a>.<a href="#c44_display"><span class="reference">display</span></a>.<a href="#c35_options"><span class="reference">options</span></a>.<a href="#c2_size"><span class="reference">size</span></a>.<a href="#c4_large"><span class="reference">large</span></a> <span class="keyword">]</span><br>
</div>
<figure>
  <img src="/telematics-mapping.jpg" >
  <figcaption>Fig. 4: A possible rendering of the mapping constraints</figcaption>
</figure>